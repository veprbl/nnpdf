# A single CI script with github workflow.
name: Automatic Fit

on: [push]

env:
  CONDA_PY: 37

jobs:
  build:
    runs-on: self-hosted
    steps:
    - name: Cleanup workspace
      run: |
        rm -rf /home/docker/miniconda3/conda-bld
        rm -rf /home/docker/miniconda3/envs/*
        rm -rf "${{ github.workspace }}"
    - uses: actions/checkout@v1
    - name: Build recipe and run tests on linux
      run: |
        CONDA_PY=$CONDA_PY conda build --no-test -q conda-recipe
    - name: Installing NNPDF conda package
      run: |
        conda create -n nnpdf_test /home/docker/miniconda3/conda-bld/linux-64/*.tar.bz2
